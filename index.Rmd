---
title: "wombat::gganimate"
subtitle: "Introduction to gganimate"
author: 
  - "Mitchell O'Hara-Wild"
  - "Ursula Laa"
  - "Nicholas Spyrison"
date: '30/10/2018'
output:
  xaringan::moon_reader:
    chakra: libs/remark-latest.min.js
    css: ["libs/slides.css",  "libs/animate.css"]
    lib_dir: libs
    seal: false
    nature:
      highlightStyle: github
      ratio: '16:9'
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: ["libs/jquery/jquery.min.js", "libs/slides.js"]
---
class: inverse

```{css, echo=FALSE}
/* custom.css */
.left-code {
  color: #777;
  width: 48%;
  height: 92%;
  float: left;
}
.right-plot {
  width: 50%;
  float: right;
  padding-left: 1%;
}
```



```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE, width = 120)

library(tidyverse)
library(knitr)
library(kableExtra)
library(fontawesome) #devtools::install_github("rstudio/fontawesome")
library(lubridate)
library(htmltools)
library(datasauRus)
library(gganimate)

opts_chunk$set(
  echo = FALSE, warning = FALSE, message = FALSE, comment = "#>",
  fig.path = 'figure/', cache.path = 'cache/', fig.align = 'center',
  fig.width = 12, fig.height = 4, fig.show = 'hold',
  cache = TRUE, external = TRUE, dev = 'png', dev.args = list(bg = "transparent")
)

mp4_vid <- function(src){
  HTML(
    paste0(
      '<video autoplay>
        <source src="', src, '" type="video/mp4">
      </video>'
    )
  )
}

hook_output <- knit_hooks$get("output")
knit_hooks$set(output = function(x, options) {
   lines <- options$output.lines
   if (is.null(lines)) {
     return(hook_output(x, options))  # pass to default hook
   }
   x <- unlist(strsplit(x, "\n"))
   more <- "..."
   if (length(lines)==1) {        # first n lines
     if (length(x) > lines) {
       # truncate the output, but add ....
       x <- c(head(x, lines), more)
     }
   } else {
     x <- c(more, x[lines], more)
   }
   # paste these lines together
   x <- paste(c(x, ""), collapse = "\n")
   hook_output(x, options)
 })

theme_set(
  theme_grey(base_size = 16) +
  theme(
    legend.position = "bottom",
    plot.background = element_rect(fill = "transparent"),
    legend.background = element_rect(fill = "transparent")
  )
)
```

.title[gganimate]
.sticker-float[![gganimate](resources/gganimate.png)]

## Introduction to gganimate

.bottom[
### Mitchell O'Hara-Wild (`r fa("twitter", fill="#1da1f2")`[@mitchoharawild](https://twitter.com/mitchoharawild))
### Ursula Laa (`r fa("twitter", fill="#1da1f2")`[@UschiLaa](https://twitter.com/UschiLaa/))
### Nicholas Spyrison (`r fa("twitter", fill="#1da1f2")`[@nspyrison](https://twitter.com/nspyrison/))


### 22 March 2019
### Slides @ [mitchelloharawild.com/wombat-gganimate](https://mitchelloharawild.com/wombat-gganimate)
]

---
class: inverse

---
class: inverse

.animated.rubberBand.title[gganimate]
.sticker-float[![gganimate](resources/gganimate.png)]

---
class: inverse

.title[gganimate]
.sticker-float[![gganimate](resources/gganimate.png)]

.animated.rubberBand[
.desc[Introduction to gganimate]
]

---
class: inverse

.title[gganimate]
.sticker-float[![gganimate](resources/gganimate.png)]

.desc[Introduction to gganimate]

.bottom[
.animated.zoomInDown[
### Mitchell O'Hara-Wild (`r fa("twitter", fill="#1da1f2")`[@mitchoharawild](https://twitter.com/mitchoharawild))
### Ursula Laa (`r fa("twitter", fill="#1da1f2")`[@UschiLaa](https://twitter.com/UschiLaa/))
### Nicholas Spyrison (`r fa("twitter", fill="#1da1f2")`[@nspyrison](https://twitter.com/nspyrison/))

### &nbsp;
### &nbsp;
]
]

---
class: inverse

.title[gganimate]
.sticker-float[![gganimate](resources/gganimate.png)]

.desc[Introduction to gganimate]

.bottom[
### Mitchell O'Hara-Wild (`r fa("twitter", fill="#1da1f2")`[@mitchoharawild](https://twitter.com/mitchoharawild))
### Ursula Laa (`r fa("twitter", fill="#1da1f2")`[@UschiLaa](https://twitter.com/UschiLaa/))
### Nicholas Spyrison (`r fa("twitter", fill="#1da1f2")`[@nspyrison](https://twitter.com/nspyrison/))


.animated.bounceInRight[
### 22 March 2019
### Slides @ [mitchelloharawild.com/wombat-gganimate](https://mitchelloharawild.com/wombat-gganimate)
]
]

---
class: inverse

.animated.hinge.title[gganimate]
.animated.hinge.sticker-float[![gganimate](resources/gganimate.png)]

.animated.hinge[
.desc[Introduction to gganimate]
]

.animated.hinge.bottom[
### Mitchell O'Hara-Wild (`r fa("twitter", fill="#1da1f2")`[@mitchoharawild](https://twitter.com/mitchoharawild))
### Ursula Laa (`r fa("twitter", fill="#1da1f2")`[@UschiLaa](https://twitter.com/UschiLaa/))
### Nicholas Spyrison (`r fa("twitter", fill="#1da1f2")`[@nspyrison](https://twitter.com/nspyrison/))

### 22 March 2019
### Slides @ [mitchelloharawild.com/wombat-gganimate](https://mitchelloharawild.com/wombat-gganimate)
]
]

---

## What is `gganimate`?

.pull-left[
An extension to the grammar of graphics for animation.

Specifically allows animations to be added to ggplot2 using a grammar of animation.
]

.pull-right[
```{r}
mp4_vid("resources/gganimate.mp4")
```
]

---

## What is `gganimate`?



Background information, history, etc.

.sticker-float[![gganimate](resources/gganimate.png)]

---

## Why should I animate?

the continuum static/animated/interactive

---

## Animation helps learning (find research articles)

---

## Examples of static, animated & interactive

Include examples

---

## Your turn

audience - think how you can use animations

---
## The basis - ggplot2

> a system for declaratively creating graphics, based on "The Grammar of Graphics"

Based on three simple concepts:

 * Data: input data should be formated in a data frame, where each column is a variable, and each row is an observation
 * Mapping: declaring a mapping of input data variables onto aestetics
 * geoms: the graphical primitives, e.g. geom_line, geom_point

Basic workflow: initialise a ggplot by passing in data and mapping, then add layers (geoms) and formatting specifications


---
## A simple example
### Using the economics dataset

Let's start by passing the data to ggplot

.left-code[
```{r plot1, eval=FALSE, echo=TRUE}
ggplot(economics) #<<
```
]
.right-plot[
```{r output1, ref.label="plot1", echo=FALSE, cache=TRUE, fig.height = 8}
```
]

---
## A simple example
### Using the economics dataset
The next step is to add the mapping

.left-code[
```{r plot2, eval=FALSE, echo=TRUE}
ggplot(economics) +
  aes(date, unemploy)#<<
```
]
.right-plot[
```{r output2, ref.label="plot2", echo=FALSE, cache=TRUE, fig.height = 8}
```
]
---
## A simple example
### Using the economics dataset
Now we can add a graphical primitive, lets try a scatter plot

.left-code[
```{r plot3, eval=FALSE, echo=TRUE}
ggplot(economics) +
  aes(date, unemploy) +
  geom_point() #<<
```
]
.right-plot[
```{r output3, ref.label="plot3", echo=FALSE, cache=TRUE, fig.height = 8}
```
]
---
## A simple example
### Using the economics dataset
Actually a line graph is better suited in this case

.left-code[
```{r plot4, eval=FALSE, echo=TRUE}
ggplot(economics) +
  aes(date, unemploy) +
  geom_line() #<<
```
]
.right-plot[
```{r output4, ref.label="plot4", echo=FALSE, cache=TRUE, fig.height = 8}
```
]
---
## A not-so-simple example, the datasaurus dozen
Again, we first pass in the dataset to ggplot

.left-code[
```{r plot5, eval=FALSE, echo=TRUE}
ggplot(datasaurus_dozen)#<<
```
]
.right-plot[
```{r output5, ref.label="plot5", echo=FALSE, cache=TRUE, fig.height = 10}
```
]
---
## A not-so-simple example, the datasaurus dozen
For each dataset we have x and y values, in addition we can map dataset to color

.left-code[
```{r plot6, eval=FALSE, echo=TRUE}
ggplot(datasaurus_dozen) +
  aes(x, y, color=dataset)#<<
```
]
.right-plot[
```{r output6, ref.label="plot6", echo=FALSE, cache=TRUE, fig.height = 10}
```
]
---
## A not-so-simple example, the datasaurus dozen
Trying a simple scatter plot first, but there is too much information
.left-code[
```{r plot7, eval=FALSE, echo=TRUE}
ggplot(datasaurus_dozen) +
  aes(x, y, color=dataset) +
  geom_point() #<<
```
]
.right-plot[
```{r output7, ref.label="plot7", echo=FALSE, cache=TRUE, fig.height = 10}
```
]
---
## A not-so-simple example, the datasaurus dozen
We can use facets to split up by dataset, revealing the different distributions
.left-code[
```{r plot8, eval=FALSE, echo=TRUE}
ggplot(datasaurus_dozen) +
  aes(x, y, color=dataset) +
  geom_point() +
  facet_wrap(~dataset)#<<
```
]
.right-plot[
```{r output8, ref.label="plot8", echo=FALSE, cache=TRUE, fig.height = 10}
```
]
---
## A not-so-simple example, the datasaurus dozen
We can just as easily turn it into an animation, transitioning between dataset states! 

.left-code[
```{r plot9, eval=FALSE, echo=TRUE}
ggplot(datasaurus_dozen) +
  aes(x, y) +
  geom_point() +
  transition_states(dataset, 3, 1) + #<<
  labs(title = "Dataset: {closest_state}") #<<

```
]
.right-plot[
```{r output9, ref.label="plot9", echo=FALSE, cache=TRUE, fig.height = 10}
```
]


---

class: inverse

## The grammar of animation

More details about gganimate ideas (transitions, views, shadows, enter/exit, controls)

---

## Transitions

---

## Views

---

## Shadows

---

## Entrances and exits

---

## Animation controls

---

Your turn: 

gapminder -- static ggplot


.left-code[
```{r gm_plot1, echo=T, eval=F}
library(gapminder)
theme_set(theme_bw())

p <- ggplot(
  gapminder,
  aes(x = gdpPercap, y=lifeExp, size = pop, colour = country)
) +
  geom_point(show.legend = FALSE) +
  scale_x_log10() +
  labs(x = "GDP per capita", y = "Life expectancy")
p
```
]
.right-plot[
```{r gm_output1, ref.label="gm_plot1", echo=FALSE, cache=TRUE, fig.height = 10}
```
]

---

How would you turn this into an animation?

```{r gm_plot1agian, echo=T, eval=F}
library(gapminder)
theme_set(theme_bw())

ggplot(
  gapminder,
  aes(x = gdpPercap, y=lifeExp, size = pop, colour = country)
) +
  geom_point(show.legend = FALSE) +
  scale_x_log10() +
  labs(x = "GDP per capita", y = "Life expectancy")
```

--

- Use the `transistion_*()` family

--

- `transition_time(year)`

---

transition on year

.left-code[
```{r gm_plot2_a, echo=T, eval=F}
library(gapminder)
theme_set(theme_bw())

ggplot(
  gapminder,
  aes(x = gdpPercap, y=lifeExp, size = pop, colour = country)
) +
  geom_point(show.legend = FALSE) +
  scale_x_log10() +
  labs(x = "GDP per capita", y = "Life expectancy") +
  transition_time(year) + #<<
  labs(title = "Year: {frame_time}") #<<
```
]

.right-plot[
```{r gm_output2, ref.label="gm_plot2_a", echo=FALSE, cache=TRUE, fig.height = 10}
```
]

---

View - fix width to the x-axis (scale to y-axis)

.left-code[
```{r gm_plot3, echo=T, eval=F}
library(gapminder)
theme_set(theme_bw())

ggplot(
  gapminder,
  aes(x = gdpPercap, y=lifeExp, size = pop, colour = country)
) +
  geom_point(show.legend = FALSE) +
  scale_x_log10() +
  labs(x = "GDP per capita", y = "Life expectancy") +
  transition_time(year) +
  labs(title = "Year: {frame_time}") +
  view_follow(fixed_y = TRUE) #<<
```
]
.right-plot[
```{r gm_output3, ref.label="gm_plot3", echo=FALSE, cache=TRUE, fig.height = 10}
```
]


---

Shadows - past points to show rate of change

.left-code[
```{r gm_plot4, echo=T, eval=F}
library(gapminder)
theme_set(theme_bw())

ggplot(
  gapminder,
  aes(x = gdpPercap, y=lifeExp, size = pop, colour = country)
) +
  geom_point(show.legend = FALSE) +
  scale_x_log10() +
  labs(x = "GDP per capita", y = "Life expectancy") +
  transition_time(year) +
  labs(title = "Year: {frame_time}") +
  shadow_wake(wake_length = 0.1, alpha = FALSE) #<<
```
]
.right-plot[
```{r gm_output4, ref.label="gm_plot4", echo=FALSE, cache=TRUE, fig.height = 10}
```
]

---

Add your own flavour!

```{r gm_plot5, echo=T, eval=F}
library(gapminder)
theme_set(theme_bw())

ggplot(
  gapminder,
  aes(x = gdpPercap, y=lifeExp, size = pop, colour = country)
) +
  geom_point(show.legend = FALSE) +
  scale_x_log10() +
  labs(x = "GDP per capita", y = "Life expectancy") +
  transition_time(year) +
  labs(title = "Year: {frame_time}")
```

- transition_*() family
- view_*() family
- shadow_*() family
- ggplot2 changes


---

Exporting animations - Manual tours for example

```{r export, echo=T, eval=F}
anim_save(
  filename = "./images/MyAnim.gif", animation = MyAnim,
  start_pause = 15, width = 480, height = 480, res = 150)
```

```{r, out.width='40%', out.height='40%'}
knitr::include_graphics("./resources/DIS_mt.gif")
```

---

Your turn:

Make your own animation

---

class: inverse, top

.sticker-float[![gganimate](resources/gganimate.png)]

.title[Thanks! `r fa("comments", fill = "white")`]

<br>

.larger[
`r fa("github", fill = "white")` Learn more on GitHub: [thomasp85/gganimate](https://github.com/thomasp85/gganimate)

`r fa("desktop", fill = "white")` Review slides: [mitchelloharawild.com/wombat-gganimate](https://mitchelloharawild.com/wombat-gganimate)

<br>

.footnote[This work is licensed as `r fa("creative-commons", fill="white")` BY-NC 4.0.]
]
